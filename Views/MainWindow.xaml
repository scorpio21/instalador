<Window x:Class="Instalador.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Generador de Instalación Premium" Height="650" Width="1100"
        Background="#1E1E1E" Foreground="White"
        WindowStartupLocation="CenterScreen"
        FontFamily="Segoe UI"
        AllowsTransparency="False" WindowStyle="ThreeDBorderWindow"
        Icon="pack://application:,,,/img/ico/Installer.ico">


    <Window.Resources>
        <!-- Importar ViewModels para diseño -->
        <!-- xmlns:vm="clr-namespace:Instalador.ViewModels" -->
    </Window.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Menú / Header -->
            <RowDefinition Height="*"/>    <!-- Log -->
            <RowDefinition Height="Auto"/> <!-- Status / Progreso -->
        </Grid.RowDefinitions>

        <!-- HEADER / MENU -->
        <Border Grid.Row="0" Background="#2D2D2D">
            <Menu Background="Transparent" Foreground="White" Padding="5">
                <MenuItem>
                    <MenuItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <Path Data="{StaticResource IconArchivo}" Style="{StaticResource MenuIconPath}"/>
                            <TextBlock Text="Archivo" VerticalAlignment="Center"/>
                        </StackPanel>
                    </MenuItem.Header>
                    <MenuItem Header="Salir" Click="BtnSalir_Click">
                        <MenuItem.Icon>
                            <Path Data="{StaticResource IconSalir}" Style="{StaticResource MenuIconPath}" Width="14" Height="14" Margin="0"/>
                        </MenuItem.Icon>
                    </MenuItem>
                </MenuItem>

                <MenuItem x:Name="MenuUtilidades" IsEnabled="{Binding IsProjectReady}">
                    <MenuItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <Path Data="{StaticResource IconUtilidades}" Style="{StaticResource MenuIconPath}"/>
                            <TextBlock Text="Utilidades" VerticalAlignment="Center"/>
                        </StackPanel>
                    </MenuItem.Header>
                    <MenuItem Header="Compilar">
                        <MenuItem.Icon>
                            <Path Data="{StaticResource IconCompilar}" Style="{StaticResource MenuIconPath}" Width="14" Height="14" Margin="0"/>
                        </MenuItem.Icon>
                        <MenuItem Header="Compilar Proyecto" Command="{Binding BuildCommand}">
                            <MenuItem.Icon>
                                <Path Data="{StaticResource IconPlay}" Style="{StaticResource MenuIconPath}" Width="12" Height="12" Margin="0"/>
                            </MenuItem.Icon>
                        </MenuItem>
                    </MenuItem>
                    <MenuItem Header="Crear Zip">
                        <MenuItem.Icon>
                            <Path Data="{StaticResource IconZip}" Style="{StaticResource MenuIconPath}" Width="14" Height="14" Margin="0"/>
                        </MenuItem.Icon>
                        <MenuItem Header="Publicar single-file" Command="{Binding PublishCommand}">
                            <MenuItem.Icon>
                                <Path Data="{StaticResource IconExport}" Style="{StaticResource MenuIconPath}" Width="12" Height="12" Margin="0"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem Header="Crear ZIP portable" Command="{Binding ZipPortableCommand}">
                            <MenuItem.Icon>
                                <Path Data="{StaticResource IconZip}" Style="{StaticResource MenuIconPath}" Width="12" Height="12" Margin="0"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem Header="Crear ZIP single-file" Command="{Binding ZipSingleFileCommand}">
                            <MenuItem.Icon>
                                <Path Data="{StaticResource IconZip}" Style="{StaticResource MenuIconPath}" Width="12" Height="12" Margin="0"/>
                            </MenuItem.Icon>
                        </MenuItem>
                    </MenuItem>
                    <MenuItem Header="Instalador">
                        <MenuItem.Icon>
                            <Path Data="{StaticResource IconInstalador}" Style="{StaticResource MenuIconPath}" Width="14" Height="14" Margin="0"/>
                        </MenuItem.Icon>
                        <MenuItem Header="Generar instalador" Command="{Binding InstallerCommand}">
                            <MenuItem.Icon>
                                <Path Data="{StaticResource IconInstalador}" Style="{StaticResource MenuIconPath}" Width="12" Height="12" Margin="0"/>
                            </MenuItem.Icon>
                        </MenuItem>
                    </MenuItem>
                    <Separator Background="#10FFFFFF" Height="1" Margin="5,2"/>
                    <MenuItem Header="Ejecutar todo" Command="{Binding RunAllCommand}">
                        <MenuItem.Icon>
                            <Path Data="{StaticResource IconPlay}" Style="{StaticResource MenuIconPath}" Width="14" Height="14" Margin="0"/>
                        </MenuItem.Icon>
                    </MenuItem>
                </MenuItem>

                <MenuItem x:Name="MenuLimpiar" Command="{Binding LimpiarCommand}">
                    <MenuItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <Path x:Name="IconLimpiarFlash" Data="{StaticResource IconLimpiar}" Style="{StaticResource MenuIconPath}"/>
                            <TextBlock Text="Limpiar" VerticalAlignment="Center"/>
                        </StackPanel>
                    </MenuItem.Header>
                </MenuItem>

                <MenuItem x:Name="MenuProyectos">
                    <MenuItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Proyecto:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <ComboBox x:Name="ComboProyectos" Width="150" VerticalContentAlignment="Center" Background="Transparent" Foreground="White" BorderThickness="0" Margin="5,0" 
                                      ItemsSource="{Binding Proyectos}" SelectedItem="{Binding ProyectoSeleccionado}">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <Path Data="{StaticResource IconArchivo}" Fill="White" Width="12" Height="12" Stretch="Uniform" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                            <TextBlock Text="{Binding Nombre}" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                        </StackPanel>
                    </MenuItem.Header>
                </MenuItem>

                <MenuItem x:Name="MenuCombo">
                    <MenuItem.Header>
                        <ComboBox x:Name="ComboConfig" Width="100" VerticalContentAlignment="Center" Background="Transparent" Foreground="White" BorderThickness="0" Margin="5,0">
                            <ComboBoxItem IsSelected="True">
                                <StackPanel Orientation="Horizontal">
                                    <Path Data="{StaticResource IconPlay}" Fill="White" Width="12" Height="12" Stretch="Uniform" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                    <TextBlock Text="Release" VerticalAlignment="Center"/>
                                </StackPanel>
                            </ComboBoxItem>
                            <ComboBoxItem>
                                <StackPanel Orientation="Horizontal">
                                    <Path Data="{StaticResource IconCompilar}" Fill="#FFB900" Width="12" Height="12" Stretch="Uniform" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                    <TextBlock Text="Debug" VerticalAlignment="Center"/>
                                </StackPanel>
                            </ComboBoxItem>
                        </ComboBox>
                    </MenuItem.Header>
                </MenuItem>

                <MenuItem x:Name="BtnConfig" Click="BtnConfig_Click">
                    <MenuItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <Path Data="{StaticResource IconConfig}" Style="{StaticResource MenuIconPath}"/>
                            <TextBlock Text="Config" VerticalAlignment="Center"/>
                        </StackPanel>
                    </MenuItem.Header>
                </MenuItem>

                <!-- Ayuda -->
                <MenuItem x:Name="MenuAyuda">
                    <MenuItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <Path Data="{StaticResource IconUtilidades}" Fill="White" Width="12" Height="12" Stretch="Uniform" Margin="0,0,8,0"/>
                            <TextBlock Text="Ayuda" VerticalAlignment="Center"/>
                        </StackPanel>
                    </MenuItem.Header>
                    <MenuItem Header="Manual de uso" Click="MenuInstrucciones_Click">
                        <MenuItem.Icon>
                            <Path Data="{StaticResource IconArchivo}" Fill="White" Width="12" Height="12" Stretch="Uniform"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Header="Visitar Autor" Click="MenuAutor_Click">
                        <MenuItem.Icon>
                            <Path Data="{StaticResource IconExport}" Fill="White" Width="12" Height="12" Stretch="Uniform"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <Separator Background="#20FFFFFF"/>
                    <MenuItem Header="Acerca de..." Click="MenuAcercaDe_Click">
                        <MenuItem.Icon>
                            <Path Data="{StaticResource IconConfig}" Fill="White" Width="12" Height="12" Stretch="Uniform"/>
                        </MenuItem.Icon>
                    </MenuItem>
                </MenuItem>
            </Menu>
        </Border>

        <!-- LOG AREA -->
        <ListView Grid.Row="1" x:Name="LvLog" Background="#121212" Foreground="#fc0202ff" BorderThickness="0" Margin="10"
                  ItemsSource="{Binding LogEntries}">
            <ListView.View>
                <GridView>
                    <GridViewColumn Header="Hora" Width="100" DisplayMemberBinding="{Binding Hora}"/>
                    <GridViewColumn Header="Mensaje" Width="800" DisplayMemberBinding="{Binding Mensaje}"/>
                </GridView>
            </ListView.View>
        </ListView>

        <!-- FOOTER / GIT STATUS -->
        <StatusBar Grid.Row="2" Background="#007ACC" Foreground="White" BorderThickness="0,1,0,0" BorderBrush="#33FFFFFF">
            <StatusBarItem>
                <StackPanel Orientation="Horizontal" Margin="5,0" Cursor="Hand" ToolTip="Refrescar estado de Git">
                    <StackPanel.InputBindings>
                        <MouseBinding MouseAction="LeftClick" Command="{Binding ActualizarGitCommand}"/>
                    </StackPanel.InputBindings>
                    <Path x:Name="IconGit" Data="{StaticResource IconZip}" Fill="White" Width="12" Height="12" Stretch="Uniform" Margin="0,0,8,0" VerticalAlignment="Center"/>
                    <TextBlock x:Name="TxtGitBranch" Text="{Binding GitBranch}" VerticalAlignment="Center" FontSize="11"/>
                    <Ellipse x:Name="DotGitChanges" Width="6" Height="6" Fill="#FFB900" Margin="8,0,0,0" VerticalAlignment="Center">
                        <Ellipse.Style>
                            <Style TargetType="Ellipse">
                                <Setter Property="Fill" Value="Orange"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding HasGitChanges}" Value="False">
                                        <Setter Property="Fill" Value="LightGreen"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Ellipse.Style>
                    </Ellipse>
                </StackPanel>
            </StatusBarItem>
            
            <Separator Background="#33FFFFFF"/>

            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Tiempo:" VerticalAlignment="Center" Margin="0,0,5,0" FontSize="11"/>
                    <TextBlock x:Name="TxtTiempo" Text="00:00" VerticalAlignment="Center" FontSize="11"/>
                </StackPanel>
            </StatusBarItem>

            <StatusBarItem HorizontalAlignment="Right">
                <StackPanel Orientation="Horizontal">
                    <ProgressBar x:Name="ProgressTotal" Height="10" Width="150" Margin="10,0" Background="#33000000" Foreground="#4EC9B0" BorderThickness="0"/>
                    <TextBlock x:Name="TxtHora" Text="00:00:00" VerticalAlignment="Center" FontSize="11" Margin="10,0"/>
                    <TextBlock x:Name="TxtAppVersion" Text="{Binding AppVersionDisplay}" FontWeight="Bold" FontSize="10" Opacity="0.7" VerticalAlignment="Center"/>
                </StackPanel>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
